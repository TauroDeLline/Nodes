#!/bin/bash

# Установка зависимостей и подготовка окружения
apt-get update && apt-get install -y wget tar curl sudo iproute2 iptables net-tools

# Рабочая директория
WORKDIR="/root/network3"
mkdir -p $WORKDIR && cd $WORKDIR

# Скачивание и распаковка файлов ноды
wget https://network3.io/ubuntu-node-v2.1.0.tar

tar -xvf ubuntu-node-v2.1.0.tar
rm -f ubuntu-node-v2.1.0.tar

# Запуск ноды
cd ubuntu-node
bash manager.sh up

# Извлечение ссылки для доступа к дашборду
ACCESS_IP=$(hostname -I | awk '{print $1}')
DASHBOARD_LINK="https://account.network3.ai/main?o=${ACCESS_IP}:8080"
echo "Dashboard link: $DASHBOARD_LINK"

# Получение API Key
API_KEY=$(bash manager.sh key)
echo "API Key: $API_KEY"

# Вывод итоговых данных
cat <<EOF

Установка завершена.
Данные для работы с нодой Network3:
- Dashboard: $DASHBOARD_LINK
- API Key: $API_KEY

Для просмотра логов выполните:
  docker logs -f Network3

Для подключения к контейнеру выполните:
  docker exec -it Network3 bash
EOF
